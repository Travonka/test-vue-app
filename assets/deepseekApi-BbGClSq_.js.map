{"version":3,"file":"deepseekApi-BbGClSq_.js","sources":["../../src/config/deepseek.ts","../../src/services/deepseekApi.ts"],"sourcesContent":["// DeepSeek API Configuration\r\nexport const DEEPSEEK_CONFIG = {\r\n  // API endpoint for DeepSeek chat completions\r\n  API_URL: 'https://api.deepseek.com/v1/chat/completions',\r\n  \r\n  // Model to use for resume analysis\r\n  MODEL: 'deepseek-chat',\r\n  \r\n  // API version\r\n  API_VERSION: '2024-01-01',\r\n  \r\n  // Request timeout in milliseconds\r\n  TIMEOUT: 30000,\r\n  \r\n  // Maximum retries for failed requests\r\n  MAX_RETRIES: 3,\r\n  \r\n  // Retry delay in milliseconds\r\n  RETRY_DELAY: 1000,\r\n};\r\n\r\n// Hardcoded API key\r\nexport const getDeepSeekApiKey = (): string => {\r\n  const apiKey = 'sk-283284a890f8466099f2bb90d5329fbc';\r\n  console.log('‚úÖ DeepSeek API key loaded:', apiKey);\r\n  return apiKey;\r\n};\r\n\r\n// Check if DeepSeek API is configured\r\nexport const isDeepSeekConfigured = (): boolean => {\r\n  return true; // Always configured since we have hardcoded key\r\n};\r\n\r\n// Request headers for DeepSeek API\r\nexport const getDeepSeekHeaders = (): Record<string, string> => {\r\n  const apiKey = getDeepSeekApiKey();\r\n  \r\n  return {\r\n    'Content-Type': 'application/json',\r\n    'Authorization': `Bearer ${apiKey}`,\r\n  };\r\n};\r\n","import { DEEPSEEK_CONFIG, getDeepSeekHeaders, getDeepSeekApiKey } from '@/config/deepseek';\r\nimport type { ResumeAnalysisPrompt } from '@/prompts/resumeAnalysis';\r\n\r\n// Types for DeepSeek API\r\nexport interface DeepSeekMessage {\r\n  role: 'system' | 'user' | 'assistant';\r\n  content: string;\r\n}\r\n\r\nexport interface DeepSeekRequest {\r\n  model: string;\r\n  messages: DeepSeekMessage[];\r\n  temperature?: number;\r\n  max_tokens?: number;\r\n  stream?: boolean;\r\n}\r\n\r\nexport interface DeepSeekResponse {\r\n  id: string;\r\n  object: string;\r\n  created: number;\r\n  model: string;\r\n  choices: Array<{\r\n    index: number;\r\n    message: {\r\n      role: string;\r\n      content: string;\r\n    };\r\n    finish_reason: string;\r\n  }>;\r\n  usage: {\r\n    prompt_tokens: number;\r\n    completion_tokens: number;\r\n    total_tokens: number;\r\n  };\r\n}\r\n\r\nexport interface DeepSeekError {\r\n  error: {\r\n    message: string;\r\n    type: string;\r\n    code?: string;\r\n  };\r\n}\r\n\r\nclass DeepSeekApiService {\r\n  private readonly baseUrl = DEEPSEEK_CONFIG.API_URL;\r\n  private readonly model = DEEPSEEK_CONFIG.MODEL;\r\n  private readonly timeout = DEEPSEEK_CONFIG.TIMEOUT;\r\n\r\n  /**\r\n   * Check if API is properly configured\r\n   */\r\n  isConfigured(): boolean {\r\n    return true; // Always configured since we have hardcoded key\r\n  }\r\n\r\n  /**\r\n   * Make a request to DeepSeek API\r\n   */\r\n  private async makeRequest(request: DeepSeekRequest): Promise<DeepSeekResponse> {\r\n    console.log('üåê Making request to DeepSeek API...');\r\n    console.log('üì° API URL:', this.baseUrl);\r\n    console.log('ü§ñ Model:', this.model);\r\n\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), this.timeout);\r\n\r\n    try {\r\n      console.log('üì§ Sending request to DeepSeek...');\r\n      const response = await fetch(this.baseUrl, {\r\n        method: 'POST',\r\n        headers: getDeepSeekHeaders(),\r\n        body: JSON.stringify(request),\r\n        signal: controller.signal,\r\n      });\r\n\r\n      clearTimeout(timeoutId);\r\n      console.log('üì• Received response from DeepSeek:', response.status, response.statusText);\r\n\r\n      if (!response.ok) {\r\n        const errorData: DeepSeekError = await response.json();\r\n        console.error('‚ùå DeepSeek API Error:', errorData);\r\n        throw new Error(`DeepSeek API Error: ${errorData.error.message}`);\r\n      }\r\n\r\n      const data: DeepSeekResponse = await response.json();\r\n      console.log('‚úÖ Successfully received data from DeepSeek');\r\n      console.log('üìä Response usage:', data.usage);\r\n      return data;\r\n    } catch (error) {\r\n      clearTimeout(timeoutId);\r\n      console.error('‚ùå DeepSeek API request failed:', error);\r\n      \r\n      if (error instanceof Error) {\r\n        if (error.name === 'AbortError') {\r\n          throw new Error('Request timeout. Please try again.');\r\n        }\r\n        throw error;\r\n      }\r\n      \r\n      throw new Error('Unknown error occurred while calling DeepSeek API');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send a chat completion request\r\n   */\r\n  async chatCompletion(\r\n    messages: DeepSeekMessage[],\r\n    options: {\r\n      temperature?: number;\r\n      maxTokens?: number;\r\n    } = {}\r\n  ): Promise<string> {\r\n    const request: DeepSeekRequest = {\r\n      model: this.model,\r\n      messages,\r\n      temperature: options.temperature || 0.7,\r\n      max_tokens: options.maxTokens || 4000,\r\n      stream: false,\r\n    };\r\n\r\n    const response = await this.makeRequest(request);\r\n    \r\n    if (response.choices && response.choices.length > 0) {\r\n      return response.choices[0].message.content;\r\n    }\r\n    \r\n    throw new Error('No response from DeepSeek API');\r\n  }\r\n\r\n\r\n  /**\r\n   * Parse JSON response from DeepSeek\r\n   */\r\n  private parseJsonResponse(response: string): any {\r\n    // Try to extract JSON from markdown code block first\r\n    const jsonMatch = response.match(/```json\\s*([\\s\\S]*?)\\s*```/);\r\n    if (jsonMatch) {\r\n      console.log('üîç Found JSON in markdown block:', jsonMatch[1]);\r\n      try {\r\n        const cleanJson = jsonMatch[1].trim();\r\n        const parsedResponse = JSON.parse(cleanJson);\r\n        console.log('‚úÖ Successfully parsed JSON from markdown block');\r\n        return parsedResponse;\r\n      } catch (e) {\r\n        console.error('‚ùå Failed to parse JSON from markdown block:', e);\r\n      }\r\n    }\r\n    \r\n    // Try to find JSON without markdown (look for { at the start)\r\n    const jsonStart = response.indexOf('{');\r\n    if (jsonStart !== -1) {\r\n      const jsonEnd = response.lastIndexOf('}');\r\n      if (jsonEnd !== -1 && jsonEnd > jsonStart) {\r\n        const jsonString = response.substring(jsonStart, jsonEnd + 1);\r\n        console.log('üîç Found JSON without markdown:', jsonString);\r\n        try {\r\n          const parsedResponse = JSON.parse(jsonString);\r\n          console.log('‚úÖ Successfully parsed JSON without markdown');\r\n          return parsedResponse;\r\n        } catch (e) {\r\n          console.error('‚ùå Failed to parse JSON without markdown:', e);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Try to parse as direct JSON\r\n    try {\r\n      const parsedResponse = JSON.parse(response);\r\n      console.log('‚úÖ Successfully parsed direct JSON');\r\n      return parsedResponse;\r\n    } catch (parseError) {\r\n      console.warn('‚ùå Failed to parse as direct JSON:', parseError);\r\n    }\r\n    \r\n    // If all parsing fails, throw error\r\n    throw new Error('Failed to parse AI response as JSON. Response: ' + response.substring(0, 500) + '...');\r\n  }\r\n\r\n  /**\r\n   * Analyze resume using DeepSeek (legacy method for text)\r\n   */\r\n  async analyzeResume(prompt: ResumeAnalysisPrompt): Promise<any> {\r\n    const messages: DeepSeekMessage[] = [\r\n      { role: 'system', content: prompt.system },\r\n      { role: 'user', content: prompt.user }\r\n    ];\r\n\r\n    const response = await this.chatCompletion(messages, {\r\n      temperature: 0.3, // Lower temperature for more consistent analysis\r\n      maxTokens: 3000,\r\n    });\r\n\r\n    console.log('üì• Raw response from DeepSeek:', response);\r\n    \r\n    return this.parseJsonResponse(response);\r\n  }\r\n\r\n\r\n  /**\r\n   * Test API connection\r\n   */\r\n  async testConnection(): Promise<boolean> {\r\n    try {\r\n      const testMessages: DeepSeekMessage[] = [\r\n        { role: 'system', content: '–¢—ã - –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API.' },\r\n        { role: 'user', content: '–û—Ç–≤–µ—Ç—å \"API —Ä–∞–±–æ—Ç–∞–µ—Ç\" –µ—Å–ª–∏ —Ç—ã –ø–æ–ª—É—á–∏–ª —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.' }\r\n      ];\r\n\r\n      const response = await this.chatCompletion(testMessages, {\r\n        temperature: 0.1,\r\n        maxTokens: 50,\r\n      });\r\n\r\n      return response.includes('API —Ä–∞–±–æ—Ç–∞–µ—Ç') || response.includes('—Ä–∞–±–æ—Ç–∞–µ—Ç');\r\n    } catch (error) {\r\n      console.error('DeepSeek API connection test failed:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get API usage statistics (if available)\r\n   */\r\n  async getUsageStats(): Promise<{\r\n    totalTokens: number;\r\n    promptTokens: number;\r\n    completionTokens: number;\r\n  } | null> {\r\n    // This would require additional API calls to get usage statistics\r\n    // For now, return null as DeepSeek might not provide this endpoint\r\n    return null;\r\n  }\r\n}\r\n\r\nexport const deepSeekApiService = new DeepSeekApiService();\r\n"],"names":["DEEPSEEK_CONFIG","getDeepSeekApiKey","apiKey","getDeepSeekHeaders","DeepSeekApiService","__publicField","request","controller","timeoutId","response","errorData","data","error","messages","options","jsonMatch","cleanJson","parsedResponse","jsonStart","jsonEnd","jsonString","e","parseError","prompt","testMessages","deepSeekApiService"],"mappings":"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"}